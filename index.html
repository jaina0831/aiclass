<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒå‹•é…å° - æ‰¾åˆ°æ‚¨çš„å®Œç¾å¦ä¸€åŠ</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å®šç¾©ä¸»é¡Œé¡è‰²å’Œå­—é«” */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pink-main': '#FF69B4', /* ä¸»èƒŒæ™¯ï¼šäº®ç²‰ç´… (Hot Pink) */
                        'pink-dark': '#BE185D', /* è¼ƒæ·±çš„æ·±ç²‰ç´… (Deep Raspberry)ï¼Œç”¨æ–¼å€å¡ŠèƒŒæ™¯å’ŒæŒ‰éˆ•æ‡¸åœ */
                        'pink-light': '#FFB6C1', /* æ·ºç²‰ç´…ï¼Œç”¨æ–¼è£é£¾ */
                        'beige-main': '#F5F5DC', /* ç±³ç™½è‰² (Beige)ï¼Œç”¨æ–¼æŒ‰éˆ•èƒŒæ™¯ */
                        'text-white': '#FFFFFF', /* ç´”ç™½æ–‡å­— */
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
        /* è‡ªå®šç¾©æ¨£å¼ */
        body {
            background-color: #FF69B4; /* ç¢ºä¿æ•´å€‹é é¢èƒŒæ™¯æ˜¯ç²‰ç´… */
            color: #FFFFFF;
        }
        
        /* ç»ç’ƒæ“¬æ…‹/å¡ç‰‡æ•ˆæœ */
        .pink-glass {
            background: rgba(255, 255, 255, 0.15); /* åŠé€æ˜ç™½ */
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }

        .match-card {
            background: rgba(0, 0, 0, 0.1); /* ç¨å¾®æ·±ä¸€é»çš„åŠé€æ˜èƒŒæ™¯ */
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .match-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            border-color: #F5F5DC;
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }

        /* æ„›å¿ƒå½ˆè·³å‹•ç•« CSS */
        .heart-popup {
            position: fixed;
            pointer-events: none;
            font-size: 4rem; /* æ›´å¤§çš„æ„›å¿ƒ */
            z-index: 50;
            opacity: 0;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5)); /* æ„›å¿ƒç™¼å…‰æ•ˆæœ */
            animation: floatAndFade 1.5s ease-out forwards;
        }
        @keyframes floatAndFade {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: translateY(-80px) scale(1.2) rotate(10deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(1) rotate(-10deg);
            }
        }
    </style>
</head>
<body class="min-h-screen font-sans flex flex-col items-center py-10">

    <div id="app" class="w-full max-w-4xl px-4">

        <!-- æ¨™é ­ -->
        <header class="text-center mb-10">
            <h1 class="text-5xl font-black text-white tracking-wide drop-shadow-md">
                ğŸ’– å¿ƒå‹•é…å° MatchMate
            </h1>
            <p class="text-xl text-white/90 mt-3 font-medium">
                åœ¨ç²‰ç´…è‰²çš„æ°›åœä¸­ï¼Œé‡è¦‹å‘½å®šçš„ç·£åˆ†
            </p>
        </header>

        <!-- ä¸»è¦å…§å®¹å€å¡Š -->
        <!-- ä½¿ç”¨è‡ªå®šç¾©çš„ pink-glass é¡åˆ¥å‰µé€ é€šé€çš„ç²‰ç´…æ„Ÿ -->
        <div id="content" class="pink-glass p-8 md:p-12 rounded-3xl">
            <!-- é€™è£¡æœƒæ ¹æ“šç‹€æ…‹è¼‰å…¥ä¸åŒçš„ä»‹é¢ -->
        </div>

        <!-- éŒ¯èª¤å’Œè¨Šæ¯æç¤º -->
        <div id="message-box" class="fixed bottom-4 right-4 p-4 text-pink-main bg-beige-main font-bold rounded-xl shadow-xl hidden transition-opacity duration-300 opacity-0 border-2 border-pink-main"></div>
    </div>

    <script>
        // --- Gemini API Setup ---
        const apiKey = ""; // API key is provided at runtime
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        let isGenerating = false;
        let loveLetterDraft = {};

        // æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ç®¡ç†
        let appState = {
            step: 'welcome', // 'welcome', 'questions', 'matches'
            userName: '',
            userAnswers: {},
            currentQuestionIndex: 0,
        };

        // é…å°å•ç­”è³‡æ–™
        const questions = [
            // q1: 0=å®…å®¶, 1=å¤–å‡º
            { id: 'q1', text: 'æ‚¨æ›´å–œæ­¡å®…åœ¨å®¶äº«å—å¯§éœçš„é€±æœ«ï¼Œé‚„æ˜¯å¤–å‡ºæ¢ç´¢æ–°äº‹ç‰©ï¼Ÿ', options: ['ğŸ  å®…å®¶æ”¾é¬†', 'ğŸŒ å¤–å‡ºæ¢ç´¢'], weight: 0.3 },
            // q2: 0=å°‹æ±‚æ”¯æŒ, 1=ç¨è‡ªè§£æ±º
            { id: 'q2', text: 'åœ¨é¢å°å£“åŠ›æ™‚ï¼Œæ‚¨æœƒå‚¾å‘æ–¼å°‹æ±‚æ”¯æŒï¼Œé‚„æ˜¯ç¨è‡ªè§£æ±ºå•é¡Œï¼Ÿ', options: ['ğŸ¤ å°‹æ±‚æ”¯æŒ', 'ğŸ’ª ç¨è‡ªè§£æ±º'], weight: 0.2 },
            // q3: 0=éå¸¸é‡è¦, 1=æ™®é€š/ä¸é‡è¦
            { id: 'q3', text: 'åœ¨ä¸€æ®µé—œä¿‚ä¸­ï¼Œæ‚¨èªç‚ºå¹½é»˜æ„Ÿé‡è¦å—ï¼Ÿ', options: ['ğŸ˜‚ éå¸¸é‡è¦', 'ğŸ˜ æ™®é€š/ä¸é‡è¦'], weight: 0.25 },
            // q4: 0=ç›®æ¨™æ¸…æ™°, 1=é †å…¶è‡ªç„¶
            { id: 'q4', text: 'æ‚¨å°æœªä¾†äº”å¹´çš„è¦åŠƒæ˜¯æ¸…æ™°æ˜ç¢ºï¼Œé‚„æ˜¯é †å…¶è‡ªç„¶ï¼Ÿ', options: ['ğŸ¯ ç›®æ¨™æ¸…æ™°', 'ğŸƒ é †å…¶è‡ªç„¶'], weight: 0.25 },
        ];

        // æ¨¡æ“¬çš„æ½›åœ¨é…å°å°è±¡è³‡æ–™ - åŒ…å«ç†æƒ³ç­”æ¡ˆ (idealAnswers) ä»¥ä¾›è¨ˆç®—
        const mockMatches = [
            { 
                name: 'å°å“ˆ (Harry)', 
                age: 23, 
                bio: 'ç†±æ„›æ”å½±å’Œæ—…è¡Œçš„è‡ªç”±å·¥ä½œè€…ï¼Œå–œæ­¡éš¨æ€§ä¸”æ·±åº¦çš„å°è©±ã€‚', 
                city: 'å°åŒ—', 
                avatar: 'https://placehold.co/100x100/FFFFFF/FF69B4?text=C',
                // Harry: å–œæ­¡å¤–å‡º(1)ï¼Œå–œæ­¡é€£çµ/æ”¯æŒ(0)ï¼Œå¹½é»˜é‡è¦(0)ï¼Œéš¨èˆˆ(1)
                idealAnswers: { 'q1': 1, 'q2': 0, 'q3': 0, 'q4': 1 }
            },
            { 
                name: 'å°è³½ (Cedric)', 
                age: 26, 
                bio: 'å°å­¸æ•™å¸«ï¼Œå–œæ­¡å‹•ç‰©ï¼Œå¤¢æƒ³æ˜¯ç’°éŠä¸–ç•Œã€‚å€‹æ€§æº«å’Œä¸”æœ‰è€å¿ƒã€‚', 
                city: 'æ–°åŒ—', 
                avatar: 'https://placehold.co/100x100/FFFFFF/E05297?text=J',
                // Cedric: å–œæ­¡å¤–å‡º/æ—…éŠ(1)ï¼Œå‚¾å‘æ”¯æŒ/åœ˜é«”(0)ï¼Œå¹½é»˜é‡è¦(0)ï¼Œå·¥ä½œç©©å®šæœ‰è¦åŠƒ(0)
                idealAnswers: { 'q1': 1, 'q2': 0, 'q3': 0, 'q4': 0 }
            },
            { 
                name: 'å°å¼— (Fred)', 
                age: 25, 
                bio: 'ç§‘æŠ€æ¥­å·¥ç¨‹å¸«ï¼Œé€±æœ«å–œæ­¡å®…å®¶ç©æ¡ŒéŠå’Œçƒ¹é£ªã€‚å€‹æ€§å‹™å¯¦ä¸”é¢¨è¶£ã€‚', 
                city: 'æ–°ç«¹', 
                avatar: 'https://placehold.co/100x100/FFFFFF/FFB6C1?text=Y',
                // Fred: å–œæ­¡å®…å®¶(0)ï¼Œç¨è‡ªè§£æ±ºå•é¡Œ/å‹™å¯¦(1)ï¼Œå¹½é»˜é‡è¦(0)ï¼Œç›®æ¨™æ¸…æ™°(0)
                idealAnswers: { 'q1': 0, 'q2': 1, 'q3': 0, 'q4': 0 }
            },
        ];

        // --- åŠŸèƒ½å‡½æ•¸ ---

        function showMessage(message, type = 'info') {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.classList.remove('hidden');
            setTimeout(() => box.classList.add('opacity-100'), 10);
            
            setTimeout(() => {
                box.classList.remove('opacity-100');
                setTimeout(() => box.classList.add('hidden'), 300);
            }, 3000);
        }

        function showHeartPopUp(targetElement) {
            const rect = targetElement.getBoundingClientRect();
            const heart = document.createElement('div');
            heart.innerHTML = 'â¤ï¸';
            heart.className = 'heart-popup';
            heart.style.left = `${rect.left + rect.width / 2 - 30}px`; // Center align adjustment
            heart.style.top = `${rect.top}px`;
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }

        function copyDraft(matchName, buttonElement) {
            const textToCopy = loveLetterDraft[matchName] || '';
            if (textToCopy) {
                const tempInput = document.createElement('textarea');
                tempInput.value = textToCopy;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                const originalText = buttonElement.textContent;
                buttonElement.textContent = 'âœ… å·²è¤‡è£½';
                buttonElement.classList.replace('bg-beige-main', 'bg-green-400');
                buttonElement.classList.replace('text-pink-main', 'text-white');
                // Remove hover effect temporarily while in "copied" state
                buttonElement.classList.remove('hover:bg-pink-dark', 'hover:text-white');
                
                setTimeout(() => {
                    buttonElement.textContent = originalText;
                    buttonElement.classList.replace('bg-green-400', 'bg-beige-main');
                    buttonElement.classList.replace('text-white', 'text-pink-main');
                    // Restore hover effect
                    buttonElement.classList.add('hover:bg-pink-dark', 'hover:text-white');
                }, 2000);
            }
        }

        async function generateLoveLetter(userName, matchName, matchBio) {
            if (isGenerating) {
                showMessage('AI æ­£åœ¨æ’°å¯«ä¸­...');
                return;
            }

            const generatorButton = document.getElementById(`generateLetterBtn_${matchName}`);
            const draftArea = document.getElementById(`draftArea_${matchName}`);
            
            isGenerating = true;
            generatorButton.disabled = true;
            generatorButton.textContent = 'â³ æ’°å¯«ä¸­...';
            draftArea.innerHTML = '<div class="text-center p-4 text-white font-medium animate-pulse">ğŸ’– AI æ­£åœ¨ç·¨ç¹”ç”œèœœè©±èª...</div>';

            const systemPrompt = "ä½ æ˜¯ä¸€ä½å……æ»¿ç†±æƒ…å’Œæµªæ¼«çš„æˆ€æ„›é…å°å°ˆå®¶ã€‚è«‹æ ¹æ“šç™¼é€è€…æš±ç¨±å’Œæ¥æ”¶è€…çš„å€‹äººç°¡ä»‹ï¼Œæ’°å¯«ä¸€æ®µå……æ»¿å¸å¼•åŠ›ã€çœŸèª ä¸”å¸¶æœ‰å¹½é»˜æ„Ÿçš„ç ´å†°è¨Šæ¯ã€‚å­—é«”ç¹é«”ä¸­æ–‡ï¼Œ50å­—å·¦å³ï¼Œèªæ°£è¦å¤¢å¹»ã€å¯æ„›ã€‚";
            const userQuery = `æˆ‘æ˜¯${userName}ï¼Œå°æ–¹æ˜¯${matchName}ï¼ˆ${matchBio}ï¼‰ã€‚å¯«ä¸€æ®µé–‹å ´ç™½ã€‚`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                const generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦ã€‚';
                
                loveLetterDraft[matchName] = generatedText;

                // é¡¯ç¤ºè‰ç¨¿çš„å€åŸŸï¼šç™½è‰²åŠé€æ˜èƒŒæ™¯
                draftArea.innerHTML = `
                    <div class="mt-4 p-4 bg-white/20 rounded-xl border border-white/50 text-white">
                        <div class="font-bold mb-2 text-sm opacity-90">âœ¨ AI æ¨è–¦æƒ…æ›¸ï¼š</div>
                        <p class="whitespace-pre-wrap leading-relaxed">${generatedText}</p>
                        <button onclick="copyDraft('${matchName}', this)"
                            class="mt-3 text-sm px-4 py-2 bg-beige-main text-pink-main font-bold rounded-full hover:bg-pink-dark hover:text-white transition shadow-sm">
                            è¤‡è£½è‰ç¨¿
                        </button>
                    </div>
                `;
                showMessage('æƒ…æ›¸ç”Ÿæˆå®Œç•¢ï¼', 'success');
            } catch (error) {
                console.error(error);
                draftArea.innerHTML = '<div class="text-center p-2 text-white/80">é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</div>';
            }

            isGenerating = false;
            generatorButton.disabled = false;
            generatorButton.textContent = 'âœ¨ AI æƒ…æ›¸è‰ç¨¿';
        }

        // --- æ ¸å¿ƒç®—æ³•ï¼šè¨ˆç®—å¥‘åˆåº¦åˆ†æ•¸ ---
        function calculateScores() {
            mockMatches.forEach(match => {
                let score = 0;
                let maxPossibleScore = 100; // ç°¡åŒ–ç‚ºç™¾åˆ†æ¯”
                let currentScore = 0;

                questions.forEach(q => {
                    const userAns = appState.userAnswers[q.id];
                    const matchAns = match.idealAnswers[q.id];
                    
                    // å¦‚æœç­”æ¡ˆç›¸åŒï¼Œå¢åŠ è©²å•é¡Œæ¬Šé‡çš„åˆ†æ•¸
                    if (userAns === matchAns) {
                        currentScore += q.weight * 100;
                    }
                });

                // åŠ å…¥ä¸€é»éš¨æ©Ÿæ³¢å‹• (0~5åˆ†)ï¼Œè®“åˆ†æ•¸çœ‹èµ·ä¾†ä¸è¦å¤ªéç”Ÿç¡¬ï¼ˆä¾‹å¦‚ç¸½æ˜¯ 25, 50, 75ï¼‰
                // ä½†è¦ç¢ºä¿ä¸è¶…é 100
                let randomFlux = Math.floor(Math.random() * 5); 
                match.score = Math.min(100, Math.round(currentScore + randomFlux));
            });
        }

        // --- æ¸²æŸ“å‡½æ•¸ ---

        function renderWelcome() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="text-center space-y-8">
                    <h2 class="text-3xl font-bold text-white drop-shadow-sm">æ­¡è¿é–‹å§‹æ‚¨çš„æ—…ç¨‹</h2>
                    <p class="text-lg text-white/90">
                        è¼¸å…¥æ‚¨çš„æš±ç¨±ï¼Œè®“æˆ‘å€‘é–‹å§‹å°‹æ‰¾é‚£å€‹ <span class="font-bold border-b-2 border-white">ç‰¹åˆ¥çš„äºº</span>
                    </p>
                    <div class="max-w-sm mx-auto space-y-4">
                        <!-- è¼¸å…¥æ¡†ï¼šç±³ç™½èƒŒæ™¯ï¼Œé»‘è‰²æ–‡å­—ï¼Œç°è‰² placeholder -->
                        <input type="text" id="userName" placeholder="è«‹è¼¸å…¥æ‚¨çš„æš±ç¨±..." 
                            class="w-full p-4 text-center text-xl font-bold text-black bg-beige-main rounded-full border-4 border-white/50 focus:outline-none focus:border-white focus:ring-4 focus:ring-pink-300 placeholder-gray-400 transition shadow-lg">
                        
                        <!-- æŒ‰éˆ•ï¼šç±³ç™½èƒŒæ™¯ï¼Œç²‰ç´…æ–‡å­—ï¼Œæ‡¸åœè®Šæ·±ç²‰è‰²+ç™½å­— -->
                        <button id="startBtn" 
                            class="w-full py-4 bg-beige-main text-pink-main text-xl font-black rounded-full shadow-xl hover:bg-pink-dark hover:text-white hover:scale-105 active:scale-95 transition duration-300 border-b-4 border-pink-200">
                            ğŸš€ é–‹å§‹é…å°
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('startBtn').onclick = handleStart;
        }

        function renderQuestions() {
            const content = document.getElementById('content');
            const question = questions[appState.currentQuestionIndex];
            if (!question) return; // Should navigate to matches

            const total = questions.length;
            const current = appState.currentQuestionIndex + 1;
            const progress = (current / total) * 100;

            const optionsHtml = question.options.map((option, index) => `
                <button data-answer-index="${index}"
                    class="question-option w-full py-4 px-6 text-lg font-bold text-pink-main bg-beige-main rounded-2xl hover:bg-pink-dark hover:text-white hover:scale-[1.02] transition duration-200 shadow-md border-b-4 border-pink-100 mb-4 text-left flex justify-between items-center group"
                >
                    <span>${option}</span>
                    <span class="opacity-0 group-hover:opacity-100 transition">ğŸ‘‰</span>
                </button>
            `).join('');

            content.innerHTML = `
                <div class="w-full mb-8">
                    <div class="flex justify-between text-white/80 font-bold mb-2 text-sm uppercase tracking-widest">
                        <span>Question ${current}</span>
                        <span>${total}</span>
                    </div>
                    <!-- é€²åº¦æ¢ï¼šç™½è‰²è»Œé“ï¼Œç²‰ç´…é€²åº¦ -->
                    <div class="w-full bg-black/20 rounded-full h-3 backdrop-blur-sm">
                        <div class="bg-beige-main h-3 rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)]" style="width: ${progress}%"></div>
                    </div>
                </div>
                
                <h2 class="text-3xl font-bold mb-10 text-center text-white leading-relaxed drop-shadow-md">
                    ${question.text}
                </h2>
                
                <div class="max-w-md mx-auto">
                    ${optionsHtml}
                </div>
            `;

            document.querySelectorAll('.question-option').forEach(btn => btn.onclick = handleAnswer);
        }

        function renderMatches() {
            // åœ¨æ¸²æŸ“çµæœå‰ï¼Œå…ˆè¨ˆç®—åˆ†æ•¸
            calculateScores();

            const content = document.getElementById('content');
            const sortedMatches = [...mockMatches].sort((a, b) => b.score - a.score);

            const matchesHtml = sortedMatches.map(match => `
                <div class="match-card p-6 rounded-2xl mb-6 relative overflow-hidden group">
                    <!-- èƒŒæ™¯å…‰æšˆè£é£¾ -->
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
                    
                    <div class="relative flex items-center z-10">
                        <img src="${match.avatar}" class="w-24 h-24 rounded-full object-cover border-4 border-beige-main shadow-md mr-6">
                        
                        <div class="flex-grow">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-2xl font-bold text-white">${match.name}</h3>
                                <span class="bg-beige-main text-pink-main px-3 py-1 rounded-full text-sm font-black shadow-sm">
                                    ${match.score}% å¥‘åˆ
                                </span>
                            </div>
                            <p class="text-white/90 text-sm mb-4 font-medium">${match.bio} <br> <span class="opacity-75 text-xs">ğŸ“ ${match.city}, ${match.age}æ­²</span></p>
                            
                            <div class="flex gap-3">
                                <button id="signalBtn_${match.name}" onclick="handleSendSignal('${match.name}')"
                                    class="flex-1 py-2 bg-beige-main text-pink-main text-sm font-bold rounded-full hover:bg-pink-dark hover:text-white transition shadow-sm border border-transparent">
                                    â¤ï¸ å¿ƒå‹•
                                </button>
                                <button id="generateLetterBtn_${match.name}" onclick="generateLoveLetter('${appState.userName}', '${match.name}', \`${match.bio}\`)"
                                    class="flex-1 py-2 bg-beige-main text-pink-main text-sm font-bold rounded-full hover:bg-pink-dark hover:text-white transition shadow-sm border border-transparent">
                                    âœ¨ AI æƒ…æ›¸
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- è‰ç¨¿å€ -->
                    <div id="draftArea_${match.name}"></div>
                </div>
            `).join('');

            content.innerHTML = `
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-white">ğŸ‰ é…å°æˆåŠŸï¼</h2>
                    <p class="text-white/80 mt-2">æ ¹æ“šæ‚¨çš„å›ç­”ï¼Œæˆ‘å€‘ç‚ºæ‚¨è¨ˆç®—å‡ºäº†å¥‘åˆåº¦ï¼š</p>
                </div>

                <div class="space-y-6">
                    ${matchesHtml}
                </div>

                <div class="text-center mt-12">
                    <button onclick="handleStartOver()"
                        class="px-8 py-3 bg-beige-main text-pink-main text-lg font-bold rounded-full hover:bg-pink-dark hover:text-white transition duration-300 shadow-lg">
                        ğŸ”„ é‡æ–°é…å°
                    </button>
                </div>
            `;
        }

        // --- é‚è¼¯æ§åˆ¶ ---

        function handleStart() {
            const name = document.getElementById('userName').value.trim();
            if (name.length < 1) {
                showMessage('è«‹å‘Šè¨´æˆ‘æ‚¨çš„åå­—ï¼');
                return;
            }
            appState.userName = name;
            appState.step = 'questions';
            render();
        }

        function handleAnswer(e) {
            // ç²å–æŒ‰éˆ•ä¸Šçš„ç­”æ¡ˆ index
            const answerIndex = parseInt(e.currentTarget.dataset.answerIndex);
            // ç²å–ç•¶å‰å•é¡Œçš„ ID
            const questionId = questions[appState.currentQuestionIndex].id;
            
            // å„²å­˜ç”¨æˆ¶çš„ç­”æ¡ˆ
            appState.userAnswers[questionId] = answerIndex;

            appState.currentQuestionIndex++;
            if (appState.currentQuestionIndex >= questions.length) {
                appState.step = 'matches';
            }
            render();
        }

        function handleSendSignal(matchName) {
            const btn = document.getElementById(`signalBtn_${matchName}`);
            showMessage(`å·²ç™¼é€å¿ƒå‹•çµ¦ ${matchName}ï¼`);
            showHeartPopUp(btn);
        }

        function handleStartOver() {
            appState.step = 'welcome';
            appState.currentQuestionIndex = 0;
            appState.userAnswers = {}; // é‡ç½®ç­”æ¡ˆ
            render();
        }

        function render() {
            if (appState.step === 'welcome') renderWelcome();
            else if (appState.step === 'questions') renderQuestions();
            else if (appState.step === 'matches') renderMatches();
        }

        // Init
        render();

    </script>
</body>
</html>
